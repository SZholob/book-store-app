<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title th:text="#{admin.clients.title}">Manage Clients</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div th:replace="~{fragments/navbar :: header}"></div>

<div class="d-flex justify-content-between align-items-center mb-4 px-4 mt-4">
  <h2 th:text="#{admin.clients.header}">Client Manager</h2>

  <form action="/clients" method="get" class="d-flex gap-2">
    <input type="text"
           name="keyword"
           class="form-control"
           th:placeholder="#{admin.clients.search.placeholder}"
           th:value="${keyword}">

    <select name="isBlocked"
            class="form-select w-auto"
            onchange="this.form.submit()">
      <option value=""
              th:selected="${isBlocked == null}"
              th:text="#{admin.clients.status.all}">
        Status: All
      </option>
      <option value="true"
              th:selected="${isBlocked == true}"
              th:text="#{admin.clients.status.blocked}">
        Blocked
      </option>
      <option value="false"
              th:selected="${isBlocked == false}"
              th:text="#{admin.clients.status.active}">
        Active
      </option>
    </select>

    <button class="btn btn-primary"
            type="submit"
            th:text="#{admin.clients.search}">
      Search
    </button>

    <a href="/clients"
       class="btn btn-outline-secondary"
       th:text="#{admin.clients.reset}">
      Reset
    </a>
  </form>
</div>

<div class="container">

  <table class="table table-striped bg-white shadow-sm rounded align-middle">
    <thead class="table-dark">
    <tr>
      <th th:text="#{admin.clients.table.name}">Name</th>
      <th th:text="#{admin.clients.table.email}">Email</th>
      <th th:text="#{admin.clients.table.balance}">Balance</th>
      <th th:text="#{admin.clients.table.status}">Status</th>
      <th th:text="#{admin.clients.table.actions}">Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="client : ${clients}">
      <td th:text="${client.name}">Name</td>
      <td th:text="${client.email}">Email</td>

      <td th:text="${client.balance} + ' ' + #{common.currency}">
        0.00
      </td>

      <td>
        <span th:if="${client.isBlocked}"
              class="badge bg-danger"
              th:text="#{admin.clients.status.blocked.badge}">
          BLOCKED
        </span>

        <span th:unless="${client.isBlocked}"
              class="badge bg-success"
              th:text="#{admin.clients.status.active.badge}">
          ACTIVE
        </span>
      </td>

      <td>
        <div class="d-flex gap-2">

          <form th:if="${!client.isBlocked}"
                th:action="@{/clients/{email}/block(email=${client.email})}"
                method="post">
            <button class="btn btn-sm btn-outline-danger"
                    th:text="#{admin.clients.block}">
              Block ðŸ”’
            </button>
          </form>

          <form th:if="${client.isBlocked}"
                th:action="@{/clients/{email}/unblock(email=${client.email})}"
                method="post">
            <button class="btn btn-sm btn-outline-success"
                    th:text="#{admin.clients.unblock}">
              Unblock ðŸ”“
            </button>
          </form>

          <a th:href="@{/orders/manage(clientEmail=${client.email})}"
             class="btn btn-sm btn-primary"
             th:text="#{admin.clients.viewOrders}">
            View Orders ðŸ“¦
          </a>

        </div>
      </td>
    </tr>
    </tbody>
  </table>

  <div th:replace="~{fragments/pageNavigation :: pager(baseUrl='/clients')}"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
