<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="#{admin.orders.title}">Manage Orders</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div th:replace="~{fragments/navbar :: header}"></div>

<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 th:text="#{admin.orders.header}">Order Manager</h2>

        <form action="/employee/orders"
              method="get"
              class="d-flex gap-2 align-items-center bg-white p-2 rounded shadow-sm">

            <input type="text"
                   name="clientEmail"
                   class="form-control"
                   th:placeholder="#{admin.orders.search.email.placeholder}"
                   th:value="${selectedEmail}">

            <div class="vr mx-2"></div>

            <select name="status"
                    class="form-select w-auto"
                    onchange="this.form.submit()">
                <option value=""
                        th:selected="${selectedStatus == null}"
                        th:text="#{admin.orders.status.all}">
                    All Statuses
                </option>

                <option th:each="s : ${statuses}"
                        th:value="${s}"
                        th:text="#{'order.status.' + ${s.name()}}"
                        th:selected="${s.name() == selectedStatus}">
                </option>
            </select>

            <button class="btn btn-primary"
                    type="submit"
                    th:text="#{admin.orders.search}">
                Search
            </button>

            <a href="/employee/orders"
               class="btn btn-outline-secondary"
               th:text="#{admin.orders.reset}">
                Reset
            </a>
        </form>
    </div>

    <table class="table table-hover bg-white shadow-sm rounded align-middle">
        <thead class="table-dark">
        <tr>
            <th th:text="#{admin.orders.table.date}">Date</th>
            <th th:text="#{admin.orders.table.client}">Client</th>
            <th th:text="#{admin.orders.table.items}">Items</th>
            <th th:text="#{admin.orders.table.total}">Total</th>
            <th th:text="#{admin.orders.table.status}">Status</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="order : ${orders}">
            <td th:text="${#temporals.format(order.orderDate, 'dd-MM-yyyy HH:mm')}">
                Date
            </td>

            <td>
                <a th:href="@{/employee/orders(clientEmail=${order.clientEmail})}"
                   class="text-decoration-none fw-bold"
                   th:text="${order.clientEmail}">
                    Client
                </a>
            </td>

            <td>
                <small th:each="item : ${order.bookItems}">
                    <div th:text="${item.bookName} + ' x' + ${item.quantity}">
                        Book
                    </div>
                </small>
            </td>

            <td class="fw-bold"
                th:text="${order.price} + ' ' + #{common.currency}">
                Price
            </td>

            <td>
                <form th:action="@{/employee/orders/{id}/status(id=${order.id})}"
                      method="post">
                    <div class="input-group input-group-sm" style="width: 160px;">
                        <select name="status"
                                class="form-select"
                                th:classappend="${order.status.name() == 'NEW' ? 'bg-primary text-white' :
                                                 (order.status.name() == 'CANCELED' ? 'bg-danger text-white' :
                                                 (order.status.name() == 'COMPLETED' ? 'bg-success text-white' : ''))}">
                            <option th:each="s : ${statuses}"
                                    th:value="${s}"
                                    th:text="#{'order.status.' + ${s.name()}}"
                                    th:selected="${s == order.status}">
                            </option>
                        </select>

                        <button class="btn btn-outline-secondary"
                                type="submit"
                                th:text="#{admin.orders.save}">
                            ðŸ’¾
                        </button>
                    </div>
                </form>
            </td>
        </tr>
        </tbody>
    </table>

    <div th:replace="~{fragments/pageNavigation :: pager(baseUrl='/employee/orders')}"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
